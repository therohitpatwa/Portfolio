---
// Particle Background Component with triangle particles, trails, and scatter on hover
---

<div
  id="particles-container"
  class="fixed inset-0 w-full h-full"
  style="z-index: 1; pointer-events: none;"
>
</div>

<script>
  import { tsParticles } from "@tsparticles/engine";
  import { loadSlim } from "@tsparticles/slim";

  async function initParticles() {
    await loadSlim(tsParticles);

    const getCurrentTheme = () => {
      return document.documentElement.getAttribute("data-theme") || "black";
    };

    const isDarkTheme = () => {
      const theme = getCurrentTheme();
      return theme === "black" || theme === "dark";
    };

    const loadParticles = async () => {
      const container = document.getElementById("particles-container");
      if (!container) return;

      const dark = isDarkTheme();

      await tsParticles.load({
        id: "particles-container",
        options: {
          background: {
            color: {
              value: "transparent",
            },
          },
          fpsLimit: 120,
          interactivity: {
            events: {
              onHover: {
                enable: true,
                mode: "repulse",
              },
            },
            modes: {
              repulse: {
                distance: 150,
                duration: 0.4,
                factor: 100,
                speed: 1,
                maxSpeed: 50,
                easing: "ease-out-quad",
              },
            },
          },
          fullScreen: {
            enable: false,
            zIndex: 1,
          },
          particles: {
            color: {
              value: dark ? "#ffffff" : "#000000",
            },
            links: {
              enable: false,
            },
            move: {
              direction: "none",
              enable: true,
              outModes: {
                default: "bounce",
              },
              random: true,
              speed: { min: 0.5, max: 1.5 },
              straight: false,
              trail: {
                enable: true,
                fill: {
                  color: dark ? "#000000" : "#ffffff",
                },
                length: 5,
              },
            },
            number: {
              density: {
                enable: true,
              },
              value: 100,
            },
            opacity: {
              value: dark ? 1 : 0.6,
              animation: {
                enable: true,
                speed: 0.3,
                sync: false,
              },
            },
            shape: {
              type: "triangle",
            },
            size: {
              value: {
                min: 2.5,
                max: 3.5,
              },
            },
          },
          detectRetina: true,
        },
      });
    };

    // Initial load
    await loadParticles();

    // Reload particles on theme change
    const observer = new MutationObserver(async (mutations) => {
      for (const mutation of mutations) {
        if (
          mutation.type === "attributes" &&
          mutation.attributeName === "data-theme"
        ) {
          await loadParticles();
        }
      }
    });

    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ["data-theme"],
    });
  }

  // Initialize when DOM is ready
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initParticles);
  } else {
    initParticles();
  }
</script>
