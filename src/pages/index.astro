---
export const prerender = true;

import "@fontsource-variable/dm-sans";
import Container from "../components/Container.astro";
import Footer from "../components/Footer.astro";
import Header from "../components/Header.astro";
import ActivityStatus from "../components/ActivityStatus.astro";
import SpotifyPlayer from "../components/SpotifyPlayer.astro";
import ParticleBackground from "../components/ParticleBackground.astro";
import { Icon } from "astro-icon/components";
---

<html lang="en" class="theme-loaded">
  <head>
    <script is:inline>
      (function () {
        var theme = localStorage.getItem("theme") || "black";
        var bgColor = theme === "lofi" ? "#FFFFFF" : "#000000";
        document.documentElement.setAttribute("data-theme", theme);
        document.documentElement.style.cssText =
          "background-color: " + bgColor + " !important;";
        // Write body style immediately to prevent flicker
        document.write(
          '<style id="theme-init">html,body{background-color:' +
            bgColor +
            " !important;transition:none !important;}</style>",
        );
        if (!localStorage.getItem("theme"))
          localStorage.setItem("theme", "black");
      })();
    </script>
    <style>
      /* Critical CSS - theme colors must match localStorage theme */
      html[data-theme="lofi"],
      html[data-theme="lofi"] body {
        background-color: #ffffff !important;
      }
      html[data-theme="black"],
      html[data-theme="black"] body {
        background-color: #000000 !important;
      }
      /* Enable transitions only after initial load */
      html.transitions-enabled,
      html.transitions-enabled body {
        transition: background-color 0.3s ease !important;
      }
    </style>
    <script>
      import { themeChange } from "theme-change";
      themeChange();
    </script>
    <script is:inline>
      document.addEventListener("DOMContentLoaded", () => {
        const toggle = document.querySelector("input[data-toggle-theme]");
        if (toggle) {
          toggle.checked =
            document.documentElement.getAttribute("data-theme") === "lofi";
          toggle.addEventListener("change", () => {
            const theme = document.documentElement.getAttribute("data-theme");
            if (theme) localStorage.setItem("theme", theme);
          });
        }
      });
    </script>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content={Astro.generator} />
    <title>Rohit Patwa - Full Stack Developer</title>
    <link rel="icon" type="image/png" href="/favicon.png" />
    <link rel="apple-touch-icon" href="/favicon.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="preload" href="/profile.webp" as="image" type="image/webp" />
    <link
      rel="preload"
      href="/MyResume.pdf"
      as="document"
      type="application/pdf"
    />
    <script
      defer
      src="https://cloud.umami.is/script.js"
      data-website-id="56fd739e-4a15-4f34-bd0f-77341872c698"></script>
  </head>
  <body class="flex flex-col min-h-screen relative">
    <div class="relative z-10">
      <Header />
    </div>
    <ParticleBackground />
    <div
      class="flex items-center absolute top-4 right-4 md:top-6 md:right-6 lg:top-8 lg:right-8 xl:top-10 xl:right-10 z-20"
    >
      <Icon name="carbon:moon" class="w-4 h-4" />
      <input
        type="checkbox"
        data-toggle-theme="lofi,black"
        data-act-class="ACTIVECLASS"
        class="toggle toggle-sm mx-1 bg-secondary"
      />
      <Icon name="carbon:light" class="w-4 h-4" />
    </div>

    <div
      class="mx-auto max-w-3xl w-[95vw] flex flex-col mb-4 overflow-hidden relative z-10"
    >
      <!-- Row 1: Available Badge + Activity Status -->
      <div
        class="flex items-center justify-between mb-2 gap-2 md:gap-3 flex-nowrap min-w-0"
      >
        <div
          class="available-capsule flex items-center bg-gradient-to-r from-green-950/40 to-green-900/40 backdrop-blur-lg border border-green-800/20 px-3 py-2 rounded-full flex-shrink-0 shadow-lg shadow-green-950/15 hover:shadow-green-950/25 transition-all duration-300"
        >
          <div class="relative mr-2">
            <div
              class="w-3 h-3 bg-gradient-to-br from-green-400 to-green-600 rounded-full shadow-lg shadow-green-400/60 animate-pulse"
            >
            </div>
            <div
              class="absolute inset-0 w-3 h-3 bg-green-400/30 rounded-full animate-ping"
            >
            </div>
            <div
              class="absolute inset-0 w-3 h-3 bg-green-500/20 rounded-full animate-pulse"
            >
            </div>
          </div>
          <span
            class="text-green-200/90 text-xs font-semibold tracking-wide whitespace-nowrap"
            >Available for work</span
          >
        </div>
        <div class="flex-shrink-0 min-w-0">
          <ActivityStatus />
        </div>
      </div>
      <!-- Row 2: Spotify Player -->
      <div class="mb-3">
        <SpotifyPlayer />
      </div>
      <div class="divider w-full bg-secondary h-px"></div>
    </div>
    <main
      class="mx-auto flex-grow max-h-[90vh] md:max-h-[70vh] max-w-3xl overflow-y-scroll pt-4 pb-2 grid w-[95vw] relative z-10"
    >
      <div class="container">
        <Container />
      </div>
    </main>
    <div class="relative z-10">
      <Footer />
    </div>
  </body>
</html>

<style is:global>
  body {
    font-family: "DM Sans Variable", sans-serif;
  }

  [data-theme="black"] body {
    background: #000000;
  }

  @media (min-width: 768px) {
    .container {
      display: flex;
      flex-wrap: wrap;
    }
  }

  @media (max-width: 768px) {
    .container {
      flex-direction: column;
    }
  }

  @media only screen and (max-width: 480px) {
    * {
      font-size: 12px;
    }
  }

  .overflow-y-scroll {
    overflow-x: hidden;
    scrollbar-width: 1px;
  }

  .overflow-y-scroll::-webkit-scrollbar {
    width: 3px;
  }

  .overflow-y-scroll::-webkit-scrollbar-thumb {
    background-color: oklch(var(--s));
  }

  @keyframes leaf-glow {
    0%,
    100% {
      box-shadow:
        0 0 8px rgba(34, 197, 94, 0.4),
        0 0 16px rgba(34, 197, 94, 0.2);
    }
    50% {
      box-shadow:
        0 0 12px rgba(34, 197, 94, 0.6),
        0 0 24px rgba(34, 197, 94, 0.3);
    }
  }

  .available-capsule .animate-pulse {
    animation: leaf-glow 2s ease-in-out infinite;
  }

  .tag-capsule {
    background-color: rgba(60, 60, 60, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #ffffff;
    transition: all 0.2s ease;
  }

  .tag-capsule:hover {
    background-color: rgba(80, 80, 80, 0.9);
    border-color: rgba(255, 255, 255, 0.3);
  }

  /* Diagonal hatched border strips â€” left & right edges, desktop only */
  @media (min-width: 768px) {
    body::before,
    body::after {
      content: "";
      position: fixed;
      top: 0;
      bottom: 0;
      width: 1cm;
      z-index: 50;
      pointer-events: none;
      background: repeating-linear-gradient(
        -45deg,
        transparent,
        transparent 4px,
        rgba(255, 255, 255, 0.12) 4px,
        rgba(255, 255, 255, 0.12) 5px
      );
    }

    body::before {
      left: 0;
    }

    body::after {
      right: 0;
    }

    [data-theme="lofi"] body::before,
    [data-theme="lofi"] body::after {
      background: repeating-linear-gradient(
        -45deg,
        transparent,
        transparent 4px,
        rgba(0, 0, 0, 0.1) 4px,
        rgba(0, 0, 0, 0.1) 5px
      );
    }
  }
</style>

<script>
  // Check for accordion opening flags on page load
  window.addEventListener("load", () => {
    // Check if we should open projects accordion
    if (sessionStorage.getItem("openProjectsAccordion") === "true") {
      sessionStorage.removeItem("openProjectsAccordion");
      setTimeout(() => {
        const projectsCheckbox = document.getElementById(
          "projects",
        ) as HTMLInputElement | null;
        if (projectsCheckbox) {
          projectsCheckbox.checked = true;
          // Scroll to projects section
          document
            .getElementById("projects")
            ?.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      }, 100);
    }

    // Check if we should open blog accordion
    if (sessionStorage.getItem("openBlogAccordion") === "true") {
      sessionStorage.removeItem("openBlogAccordion");
      setTimeout(() => {
        const blogCheckbox = document.getElementById(
          "blog",
        ) as HTMLInputElement | null;
        if (blogCheckbox) {
          blogCheckbox.checked = true;
          // Scroll to blog section
          document
            .getElementById("blog")
            ?.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      }, 100);
    }

    // Handle URL hash on page load
    if (window.location.hash) {
      const hash = window.location.hash.substring(1);
      setTimeout(() => {
        const checkbox = document.getElementById(
          hash,
        ) as HTMLInputElement | null;
        if (checkbox) {
          checkbox.checked = true;
          checkbox.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      }, 100);
    }

    // Remove hash from URL when accordion is closed
    const accordionCheckboxes = document.querySelectorAll(
      ".accordion-checkbox",
    );
    accordionCheckboxes.forEach((checkbox) => {
      checkbox.addEventListener("change", () => {
        const inputCheckbox = checkbox as HTMLInputElement;
        if (
          !inputCheckbox.checked &&
          window.location.hash === `#${inputCheckbox.id}`
        ) {
          // Remove hash without reloading page
          history.pushState(
            "",
            document.title,
            window.location.pathname + window.location.search,
          );
        }
      });
    });
  });
</script>
